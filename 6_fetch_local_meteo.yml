target_default: 6_fetch_local_meteo


packages:
  - dplyr
  - tidyr
  - scipiper
  - feather

file_extensions:
  - feather
  - ind

sources:
  - 6_drivers/src/local_meteo_utils.R
  - 7_drivers_munge/src/GLM_driver_utils.R

targets:
  6_fetch_local_meteo:
    depends:
      - 7_drivers_munge/mendota_out/mendota_local_meteo.csv


  aoss_meteo_dates:
    command: c(I('2009-01-01'),I('2018-11-15'))

  aoss_skip_solar:
    command: c(I('2010-06-11','2017-06-23')) # 10162 and 17174

  aoss_skip_rig:
    command: c() # unknown

  aoss_solar_tasks:
    command: create_aoss_meteo_tasks(aoss_meteo_dates, aoss_skip_solar, aoss_skip_rig)

  6_aoss_solar_tasks.yml:
    command: create_aoss_meteo_makefile(
      makefile = target_name,
      task_plan = aoss_solar_tasks,
      remake_file = I('6_fetch_local_meteo.yml'))

  6_visualize/log/6_aoss_solar_tasks.ind:
    command: loop_tasks(
      task_plan=aoss_solar_tasks, task_makefile='6_aoss_solar_tasks.yml',
      task_names=NULL,
      num_tries=I(1), sleep_on_error=I(0))

  7_drivers_munge/mendota_out/rig_meteo.feather:
    command: combine_rig_files(target_name)

  7_drivers_munge/mendota_out/solrad_meteo.feather:
    command: combine_solrad_files(target_name)

  7_drivers_munge/mendota_out/nldas_meteo.feather:
    command: combine_nldas_files(target_name,
      '6_drivers/out/feather/NLDAS_time[0.346848]_x[284]_y[144]_var[dlwrfsfc].feather',
      '6_drivers/out/feather/NLDAS_time[0.346848]_x[284]_y[144]_var[dswrfsfc].feather',
      '6_drivers/out/feather/NLDAS_time[0.346848]_x[284]_y[144]_var[apcpsfc].feather',
      '6_drivers/out/feather/NLDAS_time[0.346848]_x[284]_y[144]_var[pressfc].feather',
      '6_drivers/out/feather/NLDAS_time[0.346848]_x[284]_y[144]_var[spfh2m].feather',
      '6_drivers/out/feather/NLDAS_time[0.346848]_x[284]_y[144]_var[tmp2m].feather',
      '6_drivers/out/feather/NLDAS_time[0.346848]_x[284]_y[144]_var[ugrd10m].feather',
      '6_drivers/out/feather/NLDAS_time[0.346848]_x[284]_y[144]_var[vgrd10m].feather'
      )

  7_drivers_munge/mendota_out/mendota_local_meteo.csv:
    command: merge_aoss_nldas_meteo(target_name,
      '7_drivers_munge/mendota_out/nldas_meteo.feather',
      '7_drivers_munge/mendota_out/solrad_meteo.feather',
      '7_drivers_munge/mendota_out/rig_meteo.feather')

