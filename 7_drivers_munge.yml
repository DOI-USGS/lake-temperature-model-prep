target_default: 7_drivers_munge

packages:
  - scipiper
  - dplyr
  - stringr
  - targets

sources:
  - 6_drivers/src/nldas_feather_utils.R
  - 7_drivers_munge/src/GLM_driver_utils.R
  - 7_drivers_munge/src/GLM_driver_tasks.R
  - 7_drivers_munge/src/GCM_targets_wrapper.R
  - 7_drivers_munge/src/GCM_driver_utils.R


targets:
  7_drivers_munge:
    depends:
      - "7_drivers_munge/out/7_drivers_munged.feather.ind"

  meteo_file_dir:
    command: c(I("7_drivers_munge/out"))

  7_drivers_munge/out/cell_group_table.rds.ind:
    command: merge_cell_group_files(target_name,
      cell_group_ind = '6_drivers/log/feather/6_fetch_new_cell_tasks.ind')

  7_drivers_munge/out/7_drivers_munged.feather.ind:
    command: write_NLDAS_drivers(target_name,
      cell_group_ind = '7_drivers_munge/out/cell_group_table.rds.ind',
      ind_dir = meteo_file_dir,
      '7_drivers_munge/src/GLM_driver_utils.R')

  7_drivers_munge/out/7_GCM_driver_files.ind:
    command: build_GCM_pipeline(
      target_name,
      "2_crosswalk_munge/out/centroid_lakes_sf.rds.ind",
      "2_crosswalk_munge/out/lake_to_state_xwalk.rds.ind")
