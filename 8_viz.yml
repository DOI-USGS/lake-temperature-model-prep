target_default: 8_viz

packages:
  - scipiper
  - dplyr
  - ggplot2
  - feather
  - lakeattributes
  - leaflet
  - readr

sources:
  - 8_viz/src/merge_lake_data.R
  - 8_viz/src/render_html.R
  - 8_viz/src/plot_lake_obs_counts.R

targets:

  8_viz:
    depends:
      - 8_viz/out/lake_obs_counts.png
      - 8_viz/inout/lakes_summary.feather.ind
      - 8_viz/out/lakes_summary_fig.html.ind

  # temp_obs_ind should not be in I() but AA can't build it locally on 1/15/2020 and so is skipping
  8_viz/out/lake_obs_counts.png:
    command: plot_lake_obs_counts(
      out_file = '8_viz/out/lake_obs_counts.png',
      temp_obs_ind = '7b_temp_merge/out/temp_data_with_sources.feather.ind',
      nml_list_ind = '7_config_merge/out/nml_list.rds.ind')

#### We expect the following to be out of date as of the transition to NHD-HR:
#
#  8_viz:
#    depends:
#     - 8_viz/inout/lakes_summary.feather.ind
#
  # -- get WQP, coop data and merge -- #
  # -- removes (coarsely defined) duplicates -- #
  # -- removes egregious outliers in Jan/Feb (>10 deg C) and July/Aug (surface, <10 deg C)
  # -- returns all times -- ##

  # update with booleans for:
  # has meteo, max depth, hypso, kw, kw_file, obs...
  8_viz/inout/lakes_summary.feather.ind:
    command: merge_lake_data(
      out_ind = target_name,
      temp_data_fl = I('7b_temp_merge/out/temp_data_with_sources.feather'),
      lake_names_ind = '2_crosswalk_munge/out/gnisname_nhdhr_xwalk.rds.ind',
      lake_loc_ind = '7_config_merge/out/nml_lat_lon_values.rds.ind',
      lake_data_ind = '7_config_merge/out/nml_H_A_values.rds.ind',
      lagos_xwalk = "2_crosswalk_munge/out/lagosne_nhdhr_xwalk.rds.ind",
      MGLP_xwalk = "2_crosswalk_munge/out/mglp_nhdhr_xwalk.rds.ind",
      WBIC_xwalk = "2_crosswalk_munge/out/wbic_nhdhr_xwalk.rds.ind",
      Micorps_xwalk = "2_crosswalk_munge/out/micorps_nhdhr_xwalk.rds.ind",
      MNDOW_xwalk = "2_crosswalk_munge/out/mndow_nhdhr_xwalk.rds.ind",
      Winslow_xwalk = "2_crosswalk_munge/out/winslow_nhdhr_xwalk.rds.ind",
      NDGF_xwalk = "2_crosswalk_munge/out/ndgf_nhdhr_xwalk.rds.ind",
      kw_ind = "7_config_merge/out/nml_Kw_values.rds.ind",
      meteo_ind = "7_config_merge/out/nml_meteo_fl_values.rds.ind",
      kw_file_fl = "~/Downloads/nhdhr_ids_time_varying_clarity.rds")

  8_viz/inout/lakes_summary.feather:
    command: gd_get('8_viz/inout/lakes_summary.feather.ind')

  8_viz/out/lakes_summary_fig.html.ind:
    command: render_html(filename_md = 'lake_data_map.Rmd', out_ind = target_name)
    depends:
      - 8_viz/inout/lakes_summary.feather.ind

  8_viz/out/lakes_summary_fig.html:
    command: gd_get('8_viz/out/lakes_summary_fig.html.ind')

  ##### Adding summary and visual of data that we are thinking of using for TOHA

  # These two datasets help visualize and summarize the data we are using for TOHA models.
  # They were downloaded from here: https://drive.google.com/drive/u/4/folders/13w3QDXicjHVymVW1NeyJpJqVRZ7KvlTD
  # Then put inside of `in`
  walleye_count_data:
    command: read_csv(I("8_viz/in/WAE_numYears_meanCPUE.csv"))
  time_varying_kw_sites:
    command: readRDS(I("8_viz/in/nhdhr_ids_time_varying_clarity.rds"))

  8_viz/inout/summary_toha_sf.rds.ind:
    command: summarize_MN_toha_lake_data(
      out_ind = target_name,
      mndow_xwalk_ind = "2_crosswalk_munge/out/mndow_nhdhr_xwalk.rds.ind",
      lake_summary_ind = "8_viz/inout/lakes_summary.feather.ind",
      walleye_count_data = walleye_count_data,
      time_varying_kw_sites = time_varying_kw_sites)

  8_viz/out/summary_toha_sf.rds:
    command: gd_get('8_viz/out/summary_toha_sf.rds.ind')

  8_viz/out/toha_lakes_summary_fig.html.ind:
    command: render_html(filename_md = 'toha_lake_data_map.Rmd', out_ind = target_name)

  8_viz/out/toha_lakes_summary_fig.html:
    command: gd_get('8_viz/out/toha_lakes_summary_fig.html.ind')
